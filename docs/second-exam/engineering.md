# å‰ç«¯å·¥ç¨‹åŒ–

å‰ç«¯å·¥ç¨‹åŒ–é€šè¿‡è‡ªåŠ¨åŒ–å·¥å…·å’Œæ ‡å‡†åŒ–æµç¨‹ï¼Œæå‡å¼€å‘æ•ˆç‡ã€ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚å…¶æ ¸å¿ƒç›®æ ‡æ˜¯ä¼˜åŒ–å¼€å‘ã€æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²æµç¨‹ï¼Œå‡å°‘äººå·¥å¹²é¢„å’Œé‡å¤åŠ³åŠ¨ï¼Œä¾¿äºé¡¹ç›®æ‰©å±•å’Œå›¢é˜Ÿåä½œã€‚

å¸¸è§çš„å·¥å…·ï¼Œå¦‚Viteå’ŒWebpackï¼Œæä¾›é«˜æ•ˆçš„æ„å»ºå’Œæ‰“åŒ…èƒ½åŠ›ï¼Œæ˜¾è‘—æå‡å¼€å‘æ•ˆç‡å¹¶ä¸°å¯Œå‰ç«¯ç”Ÿæ€ã€‚è¿™äº›å·¥å…·çš„å¹¿æ³›åº”ç”¨ä½¿å‰ç«¯å¼€å‘æ›´åŠ é«˜æ•ˆï¼Œä¸”æˆä¸ºè¿‘å¹´æ¥é¢è¯•ä¸­çš„çƒ­é—¨è¯é¢˜ã€‚

## ä»€ä¹ˆæ˜¯å‰ç«¯å·¥ç¨‹åŒ–ï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

ä¸€å¥è¯ï¼šæŠŠâ€œå†™ä»£ç â€å˜æˆâ€œå¯å¤åˆ¶çš„ç”Ÿäº§æµç¨‹â€ï¼Œç”¨å·¥å…·ä¸è§„èŒƒæŠŠç ”å‘è¿‡ç¨‹æ ‡å‡†åŒ–ã€è‡ªåŠ¨åŒ–ï¼ŒæŒç»­æå‡æ•ˆç‡ã€è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚

æ ¸å¿ƒç›®æ ‡ï¼ˆé¢è¯•è¡¨è¾¾ï¼‰ï¼š

- ææ•ˆï¼šæœ¬åœ°å¼€å‘ä½“éªŒæ›´å¥½ï¼ˆçƒ­æ›´æ–°ã€æŒ‰éœ€ç¼–è¯‘ã€è°ƒè¯•å‹å¥½ï¼‰ï¼Œå‡å°‘é‡å¤åŠ³åŠ¨
- æè´¨ï¼šç»Ÿä¸€è§„èŒƒä¸è´¨é‡é—¨ç¦ï¼ˆLintã€æ ¼å¼åŒ–ã€ç±»å‹ã€æµ‹è¯•ï¼‰ï¼Œé™ä½çº¿ä¸Šé£é™©
- å¯ç»´æŠ¤/å¯æ‰©å±•ï¼šæ¨¡å—åŒ–ã€ç›®å½•è§„èŒƒã€ä¾èµ–æ²»ç†ï¼Œæ–¹ä¾¿å¤šäººåä½œå’Œé•¿æœŸæ¼”è¿›
- å¯äº¤ä»˜ï¼šæ„å»ºã€å‘å¸ƒã€ç›‘æ§å¯è¿½æº¯ï¼ˆCI/CDã€ç‰ˆæœ¬ç®¡ç†ã€å›æ»šä¸å‘Šè­¦ï¼‰

å¸¸è§å†…å®¹æ‹†è§£ï¼ˆè¯´å‡º 4-6 ä¸ªç‚¹å³å¯ï¼‰ï¼š

- æ„å»ºä¸æ‰“åŒ…ï¼šVite/Webpack/Rollupï¼Œä»£ç åˆ†å‰²ã€ç¼“å­˜ã€å‹ç¼©ã€äº§ç‰©åˆ†æ
- è§„èŒƒä¸çº¦æŸï¼šESLint/Prettier/Stylelintã€Git hooksã€commit è§„èŒƒã€ä»£ç è¯„å®¡
- è¯­è¨€ä¸å…¼å®¹ï¼šTypeScriptã€Babelã€polyfillã€ç›®æ ‡æµè§ˆå™¨ç­–ç•¥
- è´¨é‡ä¿éšœï¼šå•æµ‹/é›†æˆæµ‹è¯•ã€E2Eã€å¯è§‚æµ‹æ€§ï¼ˆSourcemapã€æ—¥å¿—ã€ç›‘æ§ï¼‰
- å·¥ç¨‹æ¶æ„ï¼šæ¨¡å—/ç»„ä»¶æ²‰æ·€ã€Monorepoã€åŒ…ç®¡ç†ä¸ä¾èµ–ç‰ˆæœ¬ç­–ç•¥
- å‘å¸ƒæµç¨‹ï¼šå¤šç¯å¢ƒé…ç½®ã€ç°åº¦å‘å¸ƒã€CI/CDã€è‡ªåŠ¨åŒ–éƒ¨ç½²

:::

## Vite ä¸ºä»€ä¹ˆæ›´å¿«ï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

Vite ç›¸æ¯”ä¼ ç»Ÿæ„å»ºå·¥å…·ï¼ˆå¦‚ Webpackï¼‰æ›´å¿«ğŸš€ï¼Œä¸»è¦å¾—ç›Šäºä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç‰¹æ€§ï¼š

1.  **åŸºäºåŸç”Ÿ ES æ¨¡å—ï¼ˆESMï¼‰**ï¼š

    - Vite åˆ©ç”¨æµè§ˆå™¨åŸç”Ÿçš„ ES æ¨¡å—ï¼Œåœ¨å¼€å‘æ¨¡å¼ä¸‹**æŒ‰éœ€åŠ è½½**æ¨¡å—ã€‚
    - å®ƒä¸è¿›è¡Œæ•´ä½“æ‰“åŒ…ï¼Œè€Œæ˜¯ç›´æ¥æä¾›æºç ç»™æµè§ˆå™¨ï¼ˆæµè§ˆå™¨é‡åˆ° import è¯·æ±‚å†åŠ è½½ï¼‰ï¼Œé¿å…äº†å†·å¯åŠ¨æ—¶çš„æ¼«é•¿ç­‰å¾…ã€‚

2.  **é«˜æ•ˆçš„çƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰**ï¼š

    - Vite çš„ HMR æ˜¯åŸºäº ESM çš„ã€‚å½“æ–‡ä»¶ä¿®æ”¹æ—¶ï¼ŒVite åªéœ€è¦è®©æµè§ˆå™¨é‡æ–°è¯·æ±‚è¯¥æ¨¡å—ï¼Œæ›´æ–°é€Ÿåº¦ä¸é¡¹ç›®å¤æ‚åº¦æ— å…³ï¼Œå§‹ç»ˆä¿æŒæ¯«ç§’çº§ã€‚

3.  **ä½¿ç”¨ esbuild è¿›è¡Œé¢„æ„å»º**ï¼š

    - Vite ä½¿ç”¨ **esbuild**ï¼ˆåŸºäº Go ç¼–å†™ï¼‰æ¥å¤„ç†ä¾èµ–é¢„æ„å»ºã€‚
    - esbuild æ¯”ä»¥ JavaScript ç¼–å†™çš„æ‰“åŒ…å™¨ï¼ˆå¦‚ Webpackï¼‰å¿« 10-100 å€ã€‚

4.  **æŒ‰éœ€ç¼–è¯‘**ï¼š

    - Vite åªæœ‰åœ¨æµè§ˆå™¨è¯·æ±‚æŸä¸ªæ¨¡å—æ—¶æ‰ä¼šç¼–è¯‘è¯¥æ¨¡å—ï¼Œè€Œä¸æ˜¯åƒ Webpack é‚£æ ·å…ˆç¼–è¯‘æ‰€æœ‰æ¨¡å—å†å¯åŠ¨æœåŠ¡ã€‚

5.  **ç¼“å­˜ç­–ç•¥**ï¼š
    - **ä¾èµ–æ¨¡å—**: å¼ºç¼“å­˜ (Cache-Control: max-age=31536000, immutable)ã€‚
    - **æºç æ¨¡å—**: åå•†ç¼“å­˜ (304 Not Modified)ã€‚

:::

## Vite ä¸­å¦‚ä½•ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

**å®šä¹‰**:
ç¯å¢ƒå˜é‡éœ€ä»¥ `VITE_` å‰ç¼€å¼€å¤´ï¼ŒVite æ‰ä¼šå°†å…¶æš´éœ²ç»™å®¢æˆ·ç«¯ä»£ç ã€‚

**æ–‡ä»¶ä¼˜å…ˆçº§**:

1.  `.env` (æ‰€æœ‰ç¯å¢ƒ)
2.  `.env.local` (æœ¬åœ°è¦†ç›–ï¼Œä¸æäº¤ git)
3.  `.env.[mode]` (æŒ‡å®šæ¨¡å¼ï¼Œå¦‚ .env.development)
4.  `.env.[mode].local` (æŒ‡å®šæ¨¡å¼çš„æœ¬åœ°è¦†ç›–)

**è®¿é—®**:
ä½¿ç”¨ `import.meta.env` å¯¹è±¡è®¿é—®ã€‚

**ç¤ºä¾‹**:

`.env.development`:

```properties
VITE_API_URL=http://localhost:3000
```

`main.js`:

```javascript
console.log(import.meta.env.VITE_API_URL) // http://localhost:3000
console.log(import.meta.env.MODE) // development
console.log(import.meta.env.PROD) // false
```

:::

## Vite å¦‚ä½•å®ç°å¤šç¯å¢ƒé…ç½® (qa, dev, prod)ï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

**æ–¹æ³• 1: ç¯å¢ƒå˜é‡ (æ¨è)**

åˆ›å»ºä¸åŒçš„ `.env` æ–‡ä»¶ï¼š

- `.env.development`
- `.env.production`
- `.env.qa`

è¿è¡Œè„šæœ¬æ—¶æŒ‡å®š modeï¼š

```json
{
  "scripts": {
    "dev": "vite",
    "build:qa": "vite build --mode qa",
    "build:prod": "vite build --mode production"
  }
}
```

**æ–¹æ³• 2: åŠ¨æ€é…ç½® (vite.config.js)**

ä½¿ç”¨ `defineConfig` æ¥æ”¶ `mode` å‚æ•°ï¼Œæ ¹æ®ä¸åŒç¯å¢ƒè¿”å›ä¸åŒé…ç½®ã€‚

```javascript
import { defineConfig, loadEnv } from 'vite'

export default defineConfig(({ command, mode }) => {
  // åŠ è½½å½“å‰ mode ä¸‹çš„ç¯å¢ƒå˜é‡
  const env = loadEnv(mode, process.cwd(), '')

  return {
    // åŸºç¡€é…ç½®
    plugins: [],

    // æ ¹æ® mode åšä¸åŒé…ç½®
    base: mode === 'production' ? '/prod/' : '/',
    server: {
      proxy: {
        '/api': {
          target: env.VITE_API_URL, // ä½¿ç”¨ç¯å¢ƒå˜é‡
          changeOrigin: true,
        },
      },
    },
  }
})
```

:::

## ç®€è¿° Vite çš„ä¾èµ–é¢„æ„å»ºæœºåˆ¶

::: details å‚è€ƒç­”æ¡ˆ

**ç›®çš„**:

1.  **CommonJS å’Œ UMD å…¼å®¹æ€§**: å°† CommonJS / UMD ä¾èµ–è½¬æ¢ä¸º ESMï¼Œå› ä¸ºå¼€å‘é˜¶æ®µ Vite æœåŠ¡ç«¯ä»…æ”¯æŒ ESMã€‚
2.  **æ€§èƒ½ä¼˜åŒ–**: å°†è®¸å¤šå†…éƒ¨æ¨¡å—çš„ä¾èµ–ï¼ˆå¦‚ lodash-es æœ‰ 600+ ä¸ªæ–‡ä»¶ï¼‰åˆå¹¶ä¸ºä¸€ä¸ªæ¨¡å—ï¼Œå‡å°‘ HTTP è¯·æ±‚æ¬¡æ•°ã€‚

**æµç¨‹**:

1.  **æ‰«æ**: Vite å¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨æ‰«ææºç ä¸­çš„ importï¼Œå¯»æ‰¾ node_modules ä¸­çš„ä¾èµ–ã€‚
2.  **æ„å»º**: ä½¿ç”¨ **esbuild** å°†è¿™äº›ä¾èµ–è½¬æ¢ä¸º ESM æ ¼å¼ï¼Œå¹¶æ‰“åŒ…æˆå•ä¸ªæ–‡ä»¶ã€‚
3.  **ç¼“å­˜**: ç»“æœç¼“å­˜åˆ° `node_modules/.vite` ç›®å½•ã€‚
    - **æ–‡ä»¶ç¼“å­˜**: åªæœ‰ `package.json`ã€`lock` æ–‡ä»¶æˆ– `vite.config.js` å˜åŒ–æ—¶æ‰é‡æ–°æ„å»ºã€‚
    - **æµè§ˆå™¨ç¼“å­˜**: é¢„æ„å»ºçš„ä¾èµ–è®¾ç½®äº†å¼ºç¼“å­˜ã€‚

:::

## Vite å¦‚ä½•å¤„ç†é™æ€èµ„æºï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

**1. å¯¼å…¥èµ„æº**:

```javascript
import imgUrl from './img.png' // è¿”å›è§£æåçš„ URL
document.getElementById('hero').src = imgUrl
```

**2. æ˜¾å¼ URL å¼•å…¥**:

```javascript
import imgUrl from './img.png?url' // å¼ºåˆ¶ä½œä¸º URL å¼•å…¥
```

**3. æ˜¾å¼æºç å¼•å…¥**:

```javascript
import rawContent from './shader.glsl?raw' // ä½œä¸ºå­—ç¬¦ä¸²å¼•å…¥
```

**4. Worker å¼•å…¥**:

```javascript
import Worker from './worker.js?worker' // å¼•å…¥ä¸º Web Worker
```

**5. public ç›®å½•**:
æ”¾åœ¨ `public` ç›®å½•ä¸‹çš„æ–‡ä»¶ä¼šåŸå°ä¸åŠ¨åœ°å¤åˆ¶åˆ°æ ¹ç›®å½•ï¼Œé€šè¿‡ç»å¯¹è·¯å¾„è®¿é—®ï¼ˆå¦‚ `/icon.png`ï¼‰ã€‚

**6. new URL**:

```javascript
// é€‚ç”¨äºåŠ¨æ€è·¯å¾„
const imgUrl = new URL(`./dir/${name}.png`, import.meta.url).href
```

:::

## Vite ä¸­å¦‚ä½•é…ç½® CSS é¢„å¤„ç†å™¨ï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

Vite æä¾›äº†å†…ç½®æ”¯æŒï¼Œ**æ— éœ€é…ç½® loader**ï¼Œåªéœ€å®‰è£…å¯¹åº”çš„é¢„å¤„ç†å™¨ä¾èµ–å³å¯ã€‚

**1. å®‰è£…**:

```bash
npm add -D sass # æˆ– less, stylus
```

**2. ä½¿ç”¨**:

```vue
<style lang="scss">
$color: red;
h1 {
  color: $color;
}
</style>
```

**3. å…¨å±€å˜é‡é…ç½®**:
åœ¨ `vite.config.js` ä¸­é…ç½® `css.preprocessorOptions`ï¼Œè‡ªåŠ¨æ³¨å…¥å…¨å±€å˜é‡ã€‚

```javascript
export default defineConfig({
  css: {
    preprocessorOptions: {
      scss: {
        additionalData: `@import "@/styles/variables.scss";`,
      },
      less: {
        globalVars: {
          primary: '#fff',
        },
      },
    },
  },
})
```

:::

## Vite é¡¹ç›®æœ‰å“ªäº›å¸¸è§ä¼˜åŒ–æ‰‹æ®µï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

**1. æ„å»ºä¼˜åŒ– (Build)**:

- **åˆ†åŒ… (Split Chunks)**: é…ç½® `build.rollupOptions.output.manualChunks` å°† node_modules å•ç‹¬æ‰“åŒ…ã€‚
- **Gzip å‹ç¼©**: ä½¿ç”¨ `vite-plugin-compression`ã€‚
- **å›¾ç‰‡å‹ç¼©**: ä½¿ç”¨ `vite-plugin-imagemin`ã€‚
- **CDN åŠ é€Ÿ**: ä½¿ç”¨ `vite-plugin-cdn-import` å°† React/Vue ç­‰åº“é€šè¿‡ CDN å¼•å…¥ã€‚

**2. å¼€å‘ä¼˜åŒ– (Dev)**:

- **é¢„æ„å»º**: ç¡®ä¿å¸¸ç”¨ä¾èµ–è¢«æ­£ç¡®é¢„æ„å»ºã€‚
- **å¿½ç•¥æ–‡ä»¶**: é…ç½® `server.watch.ignored` å¿½ç•¥ä¸éœ€è¦ç›‘å¬çš„æ–‡ä»¶ã€‚

**3. ä»£ç å±‚é¢**:

- **è·¯ç”±æ‡’åŠ è½½**: `const Home = () => import('./Home.vue')`ã€‚
- **æŒ‰éœ€å¼•å…¥**: ä½¿ç”¨ç»„ä»¶åº“çš„æŒ‰éœ€å¼•å…¥æ’ä»¶ï¼ˆå¦‚ `unplugin-vue-components`ï¼‰ã€‚

:::

## ç®€è¿° Vite æ’ä»¶å¼€å‘æµç¨‹

::: details å‚è€ƒç­”æ¡ˆ

Vite æ’ä»¶æ‰©å±•äº† Rollup çš„æ’ä»¶æ¥å£ï¼Œå¹¶æ·»åŠ äº† Vite ç‹¬æœ‰çš„é’©å­ã€‚

**æ ¸å¿ƒé’©å­**:

1.  `config`: ä¿®æ”¹ Vite é…ç½®ã€‚
2.  `configResolved`: é…ç½®è§£æå®Œæˆåè°ƒç”¨ã€‚
3.  `configureServer`: é…ç½®å¼€å‘æœåŠ¡å™¨ï¼ˆæ·»åŠ ä¸­é—´ä»¶ï¼‰ã€‚
4.  `transformIndexHtml`: è½¬æ¢ index.htmlã€‚
5.  `transform`: è½¬æ¢ä»£ç ï¼ˆæœ€å¸¸ç”¨ï¼‰ã€‚

**ç¤ºä¾‹ç»“æ„**:

```javascript
export default function myPlugin() {
  return {
    name: 'my-plugin',

    config(config) {
      return { define: { 'process.env': {} } }
    },

    transform(code, id) {
      if (id.endsWith('.vue')) {
        return code.replace('old', 'new')
      }
    },
  }
}
```

**ä½¿ç”¨**:

```javascript
// vite.config.js
import myPlugin from './myPlugin'
export default {
  plugins: [myPlugin()],
}
```

:::

## Vite å¦‚ä½•é…ç½®ä»£ç† (Proxy)ï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

è§£å†³å¼€å‘ç¯å¢ƒè·¨åŸŸé—®é¢˜ã€‚

```javascript
// vite.config.js
export default defineConfig({
  server: {
    proxy: {
      // å­—ç¬¦ä¸²ç®€å†™
      '/foo': 'http://localhost:4567',

      // é€‰é¡¹å†™æ³•
      '/api': {
        target: 'http://jsonplaceholder.typicode.com',
        changeOrigin: true, // ä¿®æ”¹ Host å¤´ï¼Œæ¬ºéª—åç«¯
        rewrite: (path) => path.replace(/^\/api/, ''), // å»æ‰ /api å‰ç¼€
      },

      // æ­£åˆ™å†™æ³•
      '^/fallback/.*': {
        target: 'http://jsonplaceholder.typicode.com',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/fallback/, ''),
      },
    },
  },
})
```

:::

## Vueï¼ŒReact é¡¹ç›®å¦‚ä½•é…ç½® ESLintï¼ŒPrettierï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

ç›®æ ‡ï¼šESLint ç®¡ä»£ç è´¨é‡ä¸æ½œåœ¨é”™è¯¯ï¼ŒPrettier ç®¡æ ¼å¼ï¼›ä¸¤è€…é…åˆæ—¶ï¼Œé¿å…â€œåŒä¸€æ¡è§„åˆ™æ—¢åœ¨ ESLint åˆåœ¨ Prettierâ€é€ æˆå†²çªã€‚

é€šç”¨åšæ³•ï¼ˆVue/React éƒ½ä¸€æ ·ï¼‰

1. åˆ†å·¥ä¸æ‰§è¡Œæ–¹å¼

   - ESLintï¼š`npm run lint`ï¼ˆCI å¿…è·‘ï¼‰
   - Prettierï¼š`npm run format`ï¼ˆæäº¤å‰æˆ– CI è·‘ï¼‰
   - å…³é”®ç‚¹ï¼šç”¨ `eslint-config-prettier` å…³é—­ ESLint é‡Œä¸æ ¼å¼ç›¸å…³çš„è§„åˆ™ï¼ŒæŠŠæ ¼å¼ç»Ÿä¸€äº¤ç»™ Prettier

2. é€šç”¨ä¾èµ–ä¸è„šæœ¬ï¼ˆç¤ºä¾‹ï¼‰

```json
{
  "scripts": {
    "lint": "eslint .",
    "lint:fix": "eslint . --fix",
    "format": "prettier --check .",
    "format:fix": "prettier --write ."
  }
}
```

```bash
npm add -D eslint prettier eslint-config-prettier
```

3. Prettier é…ç½®ï¼ˆç¤ºä¾‹ï¼š.prettierrcï¼‰

```json
{
  "semi": false,
  "singleQuote": true,
  "printWidth": 100,
  "trailingComma": "all"
}
```

Vue é¡¹ç›®ï¼ˆVue 3 + Vite å¸¸è§ï¼‰

1. å®‰è£…ä¾èµ–ï¼ˆæŒ‰éœ€åŠ  TSï¼‰

```bash
npm add -D eslint-plugin-vue vue-eslint-parser
```

2. ESLint é…ç½®ï¼ˆç¤ºä¾‹ï¼šeslint.config.jsï¼ŒFlat Configï¼‰

```js
import js from '@eslint/js'
import vue from 'eslint-plugin-vue'
import prettier from 'eslint-config-prettier'

export default [
  js.configs.recommended,
  ...vue.configs['flat/recommended'],
  prettier,
  {
    files: ['**/*.{ts,tsx,js,jsx,vue}'],
  },
]
```

React é¡¹ç›®ï¼ˆReact + Vite å¸¸è§ï¼‰

1. å®‰è£…ä¾èµ–ï¼ˆæŒ‰éœ€åŠ  TSï¼‰

```bash
npm add -D eslint-plugin-react eslint-plugin-react-hooks eslint-plugin-jsx-a11y
```

2. ESLint é…ç½®ï¼ˆç¤ºä¾‹ï¼šeslint.config.jsï¼ŒFlat Configï¼‰

```js
import js from '@eslint/js'
import react from 'eslint-plugin-react'
import reactHooks from 'eslint-plugin-react-hooks'
import jsxA11y from 'eslint-plugin-jsx-a11y'
import prettier from 'eslint-config-prettier'

export default [
  js.configs.recommended,
  react.configs.flat.recommended,
  reactHooks.configs.recommended,
  jsxA11y.flatConfigs.recommended,
  prettier,
  {
    settings: { react: { version: 'detect' } },
    files: ['**/*.{ts,tsx,js,jsx}'],
  },
]
```

TS é¡¹ç›®è¡¥å……ï¼ˆVue/React é€šç”¨ï¼‰

- å®‰è£…ï¼š`npm add -D typescript typescript-eslint`
- é…ç½®ï¼šåœ¨ ESLint é…ç½®é‡Œå¼•å…¥ `typescript-eslint` çš„æ¨èè§„åˆ™ï¼Œå¹¶æŠŠ `files` åŒ…å« `ts/tsx`
- ä¹ æƒ¯ï¼šç±»å‹é”™è¯¯äº¤ç»™ `tsc --noEmit` æˆ–æ¡†æ¶è‡ªå¸¦ typecheckï¼ŒESLint ä¸»è¦æŠ“â€œé€»è¾‘é—®é¢˜/åå‘³é“â€

å¸¸è§é¢è¯•è¿½é—®ç‚¹ï¼ˆç”¨ä¸€å¥è¯å›ç­”ï¼‰

- ä¸ºä»€ä¹ˆè¦ `eslint-config-prettier`ï¼šé¿å… ESLint çš„æ ¼å¼è§„åˆ™ä¸ Prettier æ‰“æ¶ã€‚
- ä¸ºä»€ä¹ˆä¸å»ºè®®ç”¨ eslint ç»Ÿä¸€åšæ ¼å¼ï¼šESLint çš„èŒè´£æ˜¯ä»£ç è´¨é‡ï¼Œæ ¼å¼äº¤ç»™ Prettier æ›´ç¨³å®šã€‚

:::

## Webpack çš„æ ¸å¿ƒæ¦‚å¿µæœ‰å“ªäº›ï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

1.  **Entry (å…¥å£)**: Webpack ä»å“ªé‡Œå¼€å§‹æ„å»ºä¾èµ–å›¾ã€‚
2.  **Output (å‡ºå£)**: æ‰“åŒ…åçš„æ–‡ä»¶è¾“å‡ºåˆ°å“ªé‡Œï¼Œæ–‡ä»¶åå«ä»€ä¹ˆã€‚
3.  **Loader (åŠ è½½å™¨)**: è®© Webpack èƒ½å¤Ÿå¤„ç†é JS æ–‡ä»¶ï¼ˆå¦‚ CSS, å›¾ç‰‡, TSï¼‰ã€‚Webpack æœ¬èº«åªç†è§£ JS/JSONã€‚
4.  **Plugin (æ’ä»¶)**: æ‰§è¡ŒèŒƒå›´æ›´å¹¿çš„ä»»åŠ¡ï¼ˆå¦‚æ‰“åŒ…ä¼˜åŒ–, èµ„æºç®¡ç†, æ³¨å…¥ç¯å¢ƒå˜é‡ï¼‰ã€‚
5.  **Mode (æ¨¡å¼)**: `development` (å¼€å‘) æˆ– `production` (ç”Ÿäº§)ï¼Œè‡ªåŠ¨å¼€å¯å¯¹åº”ä¼˜åŒ–ã€‚
6.  **Chunk (ä»£ç å—)**: æ‰“åŒ…è¿‡ç¨‹ä¸­çš„ä»£ç å—ï¼Œæœ€ç»ˆè¾“å‡ºä¸º Bundleã€‚

:::

## Webpack ä¸­ Loader å’Œ Plugin çš„åŒºåˆ«ï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

| ç‰¹æ€§         | Loader                                   | Plugin                                       |
| :----------- | :--------------------------------------- | :------------------------------------------- |
| **ä½œç”¨**     | **è½¬æ¢å™¨**ã€‚å°†é JS æ¨¡å—è½¬æ¢ä¸º JS æ¨¡å—ã€‚ | **æ‰©å±•å™¨**ã€‚å¹²é¢„æ„å»ºæµç¨‹ï¼Œæ‰§è¡Œæ›´å¤æ‚çš„ä»»åŠ¡ã€‚ |
| **è¿è¡Œæ—¶æœº** | åœ¨æ¨¡å—åŠ è½½æ—¶æ‰§è¡Œã€‚                       | åœ¨æ•´ä¸ªæ„å»ºå‘¨æœŸçš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­æ‰§è¡Œã€‚         |
| **é…ç½®æ–¹å¼** | `module.rules` ä¸­é…ç½®ã€‚                  | `plugins` æ•°ç»„ä¸­ `new Plugin()`ã€‚            |
| **ç¤ºä¾‹**     | `css-loader`, `babel-loader`             | `HtmlWebpackPlugin`, `DefinePlugin`          |

> **ä¸€å¥è¯æ€»ç»“**: Loader è´Ÿè´£æ–‡ä»¶è½¬æ¢ï¼ŒPlugin è´Ÿè´£åŠŸèƒ½æ‰©å±•ã€‚

:::

## ä»€ä¹ˆæ˜¯ Tree Shakingï¼Ÿå¦‚ä½•åœ¨ Webpack ä¸­å¯ç”¨ï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

**å®šä¹‰**:
**Tree Shaking (æ‘‡æ ‘ä¼˜åŒ–)** æ˜¯æŒ‡ç§»é™¤ JavaScript ä¸Šä¸‹æ–‡ä¸­æœªå¼•ç”¨çš„ä»£ç  (Dead Code)ã€‚

**åŸç†**:
åŸºäº **ES Module** çš„é™æ€åˆ†æã€‚ESM çš„å¯¼å…¥å¯¼å‡ºæ˜¯é™æ€çš„ï¼ŒWebpack å¯ä»¥åœ¨ç¼–è¯‘æ—¶ç¡®å®šå“ªäº›æ¨¡å—è¢«ä½¿ç”¨äº†ï¼Œå“ªäº›æ²¡è¢«ä½¿ç”¨ã€‚

**å¯ç”¨æ­¥éª¤**:

1.  **ä½¿ç”¨ ES Module**: ç¡®ä¿ä»£ç ä½¿ç”¨ `import / export`ï¼Œä¸” Babel æ²¡æœ‰å°†å…¶è½¬æ¢ä¸º CommonJS (`modules: false`)ã€‚
2.  **å¼€å¯ç”Ÿäº§æ¨¡å¼**: è®¾ç½® `mode: 'production'`ã€‚Webpack ä¼šè‡ªåŠ¨å¼€å¯ `usedExports` æ ‡è®°æœªä½¿ç”¨çš„å¯¼å‡ºï¼Œå¹¶ç”± `Terser` åˆ é™¤å®ƒä»¬ã€‚
3.  **é…ç½® sideEffects**: åœ¨ `package.json` ä¸­é…ç½® `"sideEffects": false`ï¼Œå‘Šè¯‰ Webpack é¡¹ç›®ä¸­æ²¡æœ‰å‰¯ä½œç”¨ï¼Œå¯ä»¥å¤§èƒ†åˆ é™¤æœªä½¿ç”¨çš„æ¨¡å—ã€‚å¦‚æœæœ‰å‰¯ä½œç”¨ï¼ˆå¦‚å…¨å±€ CSSï¼‰ï¼Œåˆ™ä¼ å…¥æ•°ç»„ `["*.css"]`ã€‚

:::

## Webpack å¦‚ä½•å®ç°ä»£ç åˆ†å‰² (Code Splitting)ï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

1.  **å…¥å£é…ç½® (Entry Points)**:
    - æ‰‹åŠ¨é…ç½®å¤šä¸ª entryï¼Œè¾“å‡ºå¤šä¸ª bundleã€‚
2.  **åŠ¨æ€å¯¼å…¥ (Dynamic Imports)**:
    - ä½¿ç”¨ `import('./module')` è¯­æ³•ã€‚Webpack ä¼šè‡ªåŠ¨å°†åŠ¨æ€å¯¼å…¥çš„æ¨¡å—åˆ†ç¦»æˆå•ç‹¬çš„ Chunkã€‚
    - **æ¨è**: ç»“åˆ Vue/React è·¯ç”±æ‡’åŠ è½½ä½¿ç”¨ã€‚
3.  **SplitChunksPlugin**:
    - é…ç½® `optimization.splitChunks`ã€‚
    - å¯ä»¥å°† `node_modules` ä¸­çš„ç¬¬ä¸‰æ–¹åº“æå–åˆ°å•ç‹¬çš„ `vendors` chunk ä¸­ï¼Œåˆ©ç”¨æµè§ˆå™¨ç¼“å­˜ã€‚

```javascript
// webpack.config.js
module.exports = {
  optimization: {
    splitChunks: {
      chunks: 'all', // å¯¹åŒæ­¥å’Œå¼‚æ­¥ä»£ç éƒ½è¿›è¡Œåˆ†å‰²
    },
  },
}
```

:::

## Webpack æ„å»ºé€Ÿåº¦æ…¢ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

**1. ç¼©å°æ„å»ºèŒƒå›´**:

- `include/exclude`: åœ¨ Loader é…ç½®ä¸­æ˜ç¡®æŒ‡å®šå¤„ç†ç›®å½•ï¼Œæ’é™¤ `node_modules`ã€‚
- `resolve.extensions`: å‡å°‘åç¼€åˆ—è¡¨ï¼ŒåŠ å¿«è§£æã€‚

**2. åˆ©ç”¨ç¼“å­˜**:

- `cache: { type: 'filesystem' }` (Webpack 5): å¼€å¯æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ã€‚
- `babel-loader?cacheDirectory`: å¼€å¯ Babel ç¼“å­˜ã€‚

**3. å¤šè¿›ç¨‹æ„å»º**:

- `thread-loader`: å°†è€—æ—¶çš„ Loader æ”¾åœ¨ worker æ± ä¸­è¿è¡Œã€‚

**4. DllPlugin (è¿‡æ—¶ä½†æœ‰æ•ˆ)**:

- å°†ç¬¬ä¸‰æ–¹åº“æå‰æ‰“åŒ…å¥½ï¼Œæ„å»ºæ—¶ç›´æ¥å¼•ç”¨ï¼ˆWebpack 5 æ¨èç”¨ HardSourceWebpackPlugin æˆ–è‡ªå¸¦ç¼“å­˜æ›¿ä»£ï¼‰ã€‚

**5. å¼€å‘ä½“éªŒä¼˜åŒ–**:

- å¼€å¯ `HMR` (çƒ­æ›´æ–°)ã€‚
- `devtool`: å¼€å‘ç¯å¢ƒä½¿ç”¨ `eval-cheap-module-source-map` (é€Ÿåº¦å¿«)ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨ `hidden-source-map` æˆ–ä¸ç”Ÿæˆã€‚

:::

## Vite å’Œ Webpack çš„åŒºåˆ«ï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

| ç‰¹æ€§             | Webpack                                        | Vite                                               |
| :--------------- | :--------------------------------------------- | :------------------------------------------------- |
| **æ„å»ºåŸç†**     | **Bundle-based**ã€‚å…ˆæ‰“åŒ…æ‰€æœ‰æ¨¡å—ï¼Œå†å¯åŠ¨æœåŠ¡ã€‚ | **Native ESM**ã€‚å…ˆå¯åŠ¨æœåŠ¡ï¼Œæµè§ˆå™¨è¯·æ±‚æ—¶æŒ‰éœ€ç¼–è¯‘ã€‚ |
| **å¯åŠ¨é€Ÿåº¦**     | æ…¢ (éšé¡¹ç›®ä½“ç§¯å¢å¤§è€Œå˜æ…¢)ã€‚                    | å¿« (æ¯«ç§’çº§ï¼Œä¸é¡¹ç›®ä½“ç§¯æ— å…³)ã€‚                      |
| **çƒ­æ›´æ–° (HMR)** | é‡æ–°æ„å»ºä¾èµ–æ¨¡å—ï¼Œè¾ƒæ…¢ã€‚                       | åŸºäº ESMï¼Œä»…æ›´æ–°å˜æ›´æ¨¡å—ï¼Œæå¿«ã€‚                   |
| **ç”Ÿäº§æ„å»º**     | Webpack è‡ªèº«æ‰“åŒ…ã€‚                             | ä½¿ç”¨ **Rollup** æ‰“åŒ…ã€‚                             |
| **ç”Ÿæ€**         | éå¸¸æˆç†Ÿï¼Œæ’ä»¶ä¸°å¯Œï¼Œé…ç½®å¤æ‚ã€‚                 | å‘å±•è¿…é€Ÿï¼Œé…ç½®ç®€å•ï¼Œå…¼å®¹ Rollup æ’ä»¶ã€‚             |
| **é€‚ç”¨åœºæ™¯**     | å¤§å‹å¤æ‚é¡¹ç›®ï¼Œå…¼å®¹æ€§è¦æ±‚é«˜ã€‚                   | ç°ä»£æµè§ˆå™¨é¡¹ç›®ï¼Œè¿½æ±‚å¼€å‘ä½“éªŒã€‚                     |

:::

## npm, yarn, pnpm æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

1.  **npm (v1-v4)**:

    - **åµŒå¥—ç»“æ„**: ä¾èµ–åŒ…è¢«åµŒå¥—å®‰è£…ï¼Œå¯¼è‡´ node_modules ä½“ç§¯åºå¤§ï¼Œè·¯å¾„è¿‡æ·± (Windows ä¸‹å¯èƒ½æŠ¥é”™)ã€‚
    - **ä¸ç¡®å®šæ€§**: æ—©æœŸç‰ˆæœ¬æ²¡æœ‰ lock æ–‡ä»¶ï¼Œä¸åŒæ—¶é—´å®‰è£…çš„ç‰ˆæœ¬å¯èƒ½ä¸ä¸€è‡´ã€‚

2.  **npm (v5+) / yarn**:

    - **æ‰å¹³åŒ–**: å°†ä¾èµ–å°½å¯èƒ½æå‡åˆ°é¡¶å±‚ node_modulesï¼Œè§£å†³äº†è·¯å¾„è¿‡æ·±é—®é¢˜ã€‚
    - **å¹½çµä¾èµ– (Phantom Dependencies)**: æ‰å¹³åŒ–å¸¦æ¥äº†æ–°é—®é¢˜ï¼Œä½ å¯ä»¥è®¿é—® package.json ä¸­æœªå®šä¹‰çš„åŒ…ï¼ˆå› ä¸ºå®ƒä»¬è¢«æå‡åˆ°äº†é¡¶å±‚ï¼‰ï¼Œè¿™å¯èƒ½å¯¼è‡´æ½œåœ¨ Bugã€‚
    - **Lock æ–‡ä»¶**: `package-lock.json` / `yarn.lock` é”å®šç‰ˆæœ¬ã€‚

3.  **pnpm**:
    - **ç¡¬é“¾æ¥ (Hard Links) + è½¯é“¾æ¥ (Symlinks)**: å…¨å±€å­˜å‚¨ä¸€ä»½ä¾èµ–ï¼Œé¡¹ç›®ä¸­ä½¿ç”¨ç¡¬é“¾æ¥æŒ‡å‘å…¨å±€å­˜å‚¨ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´ã€‚
    - **éæ‰å¹³åŒ–**: node_modules ç»“æ„ä¸¥æ ¼ä¸ package.json ä¸€è‡´ï¼Œ**å½»åº•è§£å†³å¹½çµä¾èµ–**ã€‚
    - **é€Ÿåº¦å¿«**: å®‰è£…é€Ÿåº¦é€šå¸¸æ˜¯ä¸‰è€…ä¸­æœ€å¿«çš„ã€‚

:::

## Babel çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

Babel æ˜¯ä¸€ä¸ª JavaScript ç¼–è¯‘å™¨ï¼Œä¸»è¦ç”¨äºå°† ES6+ ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„ JS ä»£ç ã€‚

**æ ¸å¿ƒæµç¨‹**: **è§£æ (Parse) -> è½¬æ¢ (Transform) -> ç”Ÿæˆ (Generate)**

1.  **è§£æ (Parse)**:
    - å°†æºä»£ç è½¬æ¢ä¸º **AST (æŠ½è±¡è¯­æ³•æ ‘)**ã€‚
    - åˆ†ä¸º **è¯æ³•åˆ†æ** (Tokenizing) å’Œ **è¯­æ³•åˆ†æ** (Parsing)ã€‚
2.  **è½¬æ¢ (Transform)**:
    - éå† ASTï¼Œè°ƒç”¨å„ç§ **Plugin** (å¦‚ `@babel/plugin-transform-arrow-functions`) å¯¹ AST èŠ‚ç‚¹è¿›è¡Œå¢åˆ æ”¹ã€‚
    - è¿™æ˜¯ Babel æœ€æ ¸å¿ƒçš„æ­¥éª¤ã€‚
3.  **ç”Ÿæˆ (Generate)**:
    - å°†è½¬æ¢åçš„ AST é‡æ–°ç”Ÿæˆä¸º JavaScript ä»£ç å­—ç¬¦ä¸²ï¼Œå¹¶ç”Ÿæˆ Source Mapã€‚

:::

## Git Merge å’Œ Git Rebase çš„åŒºåˆ«ï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

1.  **Merge (åˆå¹¶)**:

    - **è¡Œä¸º**: ç”Ÿæˆä¸€ä¸ªæ–°çš„ "Merge Commit"ï¼Œä¿ç•™ä¸¤ä¸ªåˆ†æ”¯çš„å®Œæ•´å†å²ã€‚
    - **ä¼˜ç‚¹**: è®°å½•çœŸå®çš„å†å²è½¨è¿¹ï¼Œéç ´åæ€§æ“ä½œã€‚
    - **ç¼ºç‚¹**: æäº¤å†å²ä¼šå‡ºç°åˆ†å‰å’Œå¤æ‚çš„åˆå¹¶çº¿ï¼Œçœ‹èµ·æ¥æ¯”è¾ƒä¹±ã€‚

2.  **Rebase (å˜åŸº)**:
    - **è¡Œä¸º**: å°†å½“å‰åˆ†æ”¯çš„æäº¤ "æ¬è¿" åˆ°ç›®æ ‡åˆ†æ”¯çš„æœ€æ–°æäº¤ä¹‹åã€‚
    - **ä¼˜ç‚¹**: æäº¤å†å²æ˜¯ä¸€æ¡ç›´çº¿ï¼Œéå¸¸å¹²å‡€æ•´æ´ã€‚
    - **ç¼ºç‚¹**: **ç ´åæ€§æ“ä½œ** (ä¿®æ”¹äº† Commit ID)ã€‚
    - **åŸåˆ™**: **æ°¸è¿œä¸è¦åœ¨å…¬å…±åˆ†æ”¯ (å¦‚ main/master) ä¸Šä½¿ç”¨ Rebase**ï¼Œåªèƒ½åœ¨è‡ªå·±çš„ Feature åˆ†æ”¯ä¸Šä½¿ç”¨ã€‚

:::

## ä»€ä¹ˆæ˜¯ Source Mapï¼Ÿç”Ÿäº§ç¯å¢ƒæ€ä¹ˆé…ï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

**å®šä¹‰**:
Source Map æ˜¯ä¸€ä¸ªæ˜ å°„æ–‡ä»¶ (`.map`)ï¼Œå­˜å‚¨äº†æºä»£ç ä¸æ„å»ºåä»£ç  (å‹ç¼©/æ··æ·†å) ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚

**ä½œç”¨**:
å½“æ„å»ºåçš„ä»£ç æŠ¥é”™æ—¶ï¼Œæµè§ˆå™¨å¯ä»¥é€šè¿‡ Source Map å®šä½åˆ°**æºä»£ç **çš„å…·ä½“ä½ç½®ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚

**ç”Ÿäº§ç¯å¢ƒé…ç½®å»ºè®®**:

1.  **å¼€æºé¡¹ç›®**: ä½¿ç”¨ `source-map` (ç”Ÿæˆç‹¬ç«‹çš„ .map æ–‡ä»¶)ï¼Œæ–¹ä¾¿å¼€å‘è€…è°ƒè¯•ã€‚
2.  **ä¼ä¸šé—­æºé¡¹ç›®**:
    - **æ¨è**: `hidden-source-map`ã€‚ç”Ÿæˆ .map æ–‡ä»¶ï¼Œä½†ä¸åœ¨ bundle ä¸­å¼•ç”¨ã€‚
    - **åšæ³•**: å°† .map æ–‡ä»¶ä¸Šä¼ åˆ° **Sentry** ç­‰ç›‘æ§å¹³å°ï¼Œç„¶ååˆ é™¤æœåŠ¡å™¨ä¸Šçš„ .map æ–‡ä»¶ã€‚è¿™æ ·æ—¢èƒ½é€šè¿‡ç›‘æ§å¹³å°çœ‹åˆ°æºç æŠ¥é”™ï¼Œåˆä¸ä¼šå‘æ™®é€šç”¨æˆ·æš´éœ²æºç ã€‚
    - **ä¸æ¨è**: `eval`, `inline-source-map` (ä½“ç§¯å¤ªå¤§ï¼Œä¸é€‚åˆç”Ÿäº§)ã€‚

:::

## Vite å¸¸ç”¨é…ç½®æœ‰å“ªäº›ï¼Ÿåˆ†åˆ«è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

å¸¸ç”¨é…ç½®å¯ä»¥æŒ‰â€œå¼€å‘ä½“éªŒã€æ„å»ºäº§ç‰©ã€å·¥ç¨‹çº¦æŸâ€æ¥å›ç­”ã€‚

1. åŸºç¡€éª¨æ¶

```ts
import { defineConfig, loadEnv } from 'vite'

export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, process.cwd(), 'VITE_')

  return {
    base: env.VITE_PUBLIC_PATH ?? '/',
  }
})
```

2. å¼€å‘æœåŠ¡å™¨ï¼ˆè·¨åŸŸä»£ç†/ç«¯å£/æ‰“å¼€æµè§ˆå™¨ï¼‰

```ts
export default defineConfig({
  server: {
    port: 5173,
    open: true,
    proxy: {
      '/api': {
        target: 'https://example.com',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, ''),
      },
    },
  },
})
```

3. è·¯å¾„åˆ«åä¸è§£æï¼ˆå‡å°‘ç›¸å¯¹è·¯å¾„åœ°ç‹±ï¼‰

```ts
import { resolve } from 'node:path'

export default defineConfig({
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
    },
  },
})
```

4. æ„å»ºé…ç½®ï¼ˆäº§ç‰©ç›®å½•/SourceMap/åˆ†åŒ…ï¼‰

```ts
export default defineConfig({
  build: {
    outDir: 'dist',
    sourcemap: false,
    rollupOptions: {
      output: {
        manualChunks: {
          react: ['react', 'react-dom'],
        },
      },
    },
  },
})
```

5. ç¯å¢ƒå˜é‡ï¼ˆå¤šç¯å¢ƒã€åŒºåˆ† dev/qa/prodï¼‰

- `.env` / `.env.development` / `.env.production`ï¼Œå¹¶é€šè¿‡ `import.meta.env` è¯»å–ã€‚
- åªä¼šæš´éœ²ä»¥ `VITE_` å¼€å¤´çš„å˜é‡åˆ°å®¢æˆ·ç«¯ã€‚

6. CSS ç›¸å…³ï¼ˆå…¨å±€å˜é‡/é¢„å¤„ç†å™¨ï¼‰

```ts
export default defineConfig({
  css: {
    preprocessorOptions: {
      scss: {
        additionalData: `@use "@/styles/vars.scss" as *;`,
      },
    },
  },
})
```

7. ä¾èµ–é¢„æ„å»ºï¼ˆä¿®å¤ä¾èµ–å…¼å®¹/åŠ é€Ÿå¯åŠ¨ï¼‰

```ts
export default defineConfig({
  optimizeDeps: {
    include: ['lodash-es'],
    exclude: ['some-big-lib'],
  },
})
```

å›ç­”æ€è·¯ï¼šä½ å…ˆè®² `server.proxy`ã€`resolve.alias`ã€`build.rollupOptions`ã€`env` è¿™å››å—ï¼ŒåŸºæœ¬å°±èƒ½è¦†ç›– 80% é¡¹ç›®é…ç½®ã€‚

:::

## Webpack å¸¸ç”¨é…ç½®æœ‰å“ªäº›ï¼Ÿåˆ†åˆ«è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ

::: details å‚è€ƒç­”æ¡ˆ

å¸¸ç”¨é…ç½®å¯ä»¥æŒ‰â€œå…¥å£å‡ºå£ã€æ¨¡å—å¤„ç†ã€å¼€å‘ä½“éªŒã€ä¼˜åŒ–ç­–ç•¥â€æ¥å›ç­”ã€‚

1. å…¥å£ä¸å‡ºå£ï¼ˆäº§ç‰©å‘½åã€å…¬å…±è·¯å¾„ã€æ¸…ç†ç›®å½•ï¼‰

```js
const path = require('path')

module.exports = {
  mode: 'production',
  entry: './src/index.js',
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: '[name].[contenthash].js',
    chunkFilename: '[name].[contenthash].chunk.js',
    publicPath: '/',
    clean: true,
  },
}
```

2. æ¨¡å—è§„åˆ™ï¼ˆLoaderï¼šå¤„ç† TS/CSS/å›¾ç‰‡ï¼‰

```js
module.exports = {
  module: {
    rules: [
      { test: /\.tsx?$/, exclude: /node_modules/, use: 'ts-loader' },
      { test: /\.css$/, use: ['style-loader', 'css-loader'] },
      { test: /\.(png|jpe?g|gif|svg)$/i, type: 'asset' },
    ],
  },
  resolve: { extensions: ['.ts', '.tsx', '.js'] },
}
```

3. æ’ä»¶ï¼ˆPluginï¼šæ³¨å…¥ HTMLã€æŠ½ç¦» CSSã€æ³¨å…¥å¸¸é‡ï¼‰

```js
const HtmlWebpackPlugin = require('html-webpack-plugin')
const MiniCssExtractPlugin = require('mini-css-extract-plugin')

module.exports = {
  plugins: [
    new HtmlWebpackPlugin({ template: './public/index.html' }),
    new MiniCssExtractPlugin({ filename: '[name].[contenthash].css' }),
  ],
}
```

4. å¼€å‘æœåŠ¡å™¨ï¼ˆHMR/ä»£ç†/History è·¯ç”±ï¼‰

```js
module.exports = {
  devServer: {
    hot: true,
    historyApiFallback: true,
    proxy: { '/api': 'http://localhost:3000' },
  },
}
```

5. ä¼˜åŒ–ï¼ˆåˆ†åŒ…ã€å‹ç¼©ã€ç¼“å­˜ï¼‰

```js
module.exports = {
  cache: { type: 'filesystem' },
  optimization: {
    splitChunks: { chunks: 'all' },
    runtimeChunk: 'single',
  },
}
```

6. SourceMapï¼ˆå¼€å‘å®šä½å¿«ï¼Œç”Ÿäº§å®‰å…¨å¯æ§ï¼‰

- å¼€å‘å¸¸ç”¨ï¼š`eval-cheap-module-source-map`
- ç”Ÿäº§å¸¸ç”¨ï¼š`hidden-source-map`ï¼ˆé…åˆ Sentry ç­‰å¹³å°ç¬¦å·åŒ–ï¼‰

å›ç­”æ€è·¯ï¼šå…ˆè¯´å››å¤§ä»¶ `entry/output/module/plugins`ï¼Œå†è¡¥ `devServer/optimization/devtool/cache`ï¼Œç»“æ„æ¸…æ™°ä¸”ä¸æ¼ç‚¹ã€‚

:::
